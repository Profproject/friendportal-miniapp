<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FriendPortal</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{box-sizing:border-box}
html,body{
margin:0;padding:0;width:100%;height:100%;
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:#000;overflow:hidden
}
.app{
position:relative;width:100%;max-width:480px;
height:100vh;margin:0 auto;
background:url("bg.png") center top/cover no-repeat;
overflow:hidden
}

/* COINS */
.coin{
position:absolute;width:70px;height:70px;
object-fit:contain;pointer-events:none;z-index:1
}

/* BUTTONS */
.buttons{
position:absolute;bottom:20px;left:0;width:100%;
padding:0 16px;display:flex;flex-direction:column;
gap:10px;z-index:5
}
.btn-img{display:flex;cursor:pointer;-webkit-tap-highlight-color:transparent}
.btn-img.left{justify-content:flex-start}
.btn-img.right{justify-content:flex-end}
.btn-img img{
max-width:250px;width:100%;
border-radius:18px;
transition:transform .12s,filter .12s
}
.btn-img.pressed img{
transform:translateY(6px) scale(.94);
filter:brightness(.85)
}

/* MODALS */
.modal{
position:fixed;inset:0;display:none;
align-items:center;justify-content:center;
background:rgba(0,0,0,.65);
backdrop-filter:blur(6px);z-index:20
}
.modal-content{
width:90%;max-height:85%;overflow:auto;
background:linear-gradient(180deg,#111,#1b1b1b);
border-radius:22px;padding:22px;color:#fff
}
.modal-content h2{color:#ffd87a}
.modal-content input{
width:100%;padding:12px;border-radius:12px;border:none;margin-top:10px
}
.modal-content button{
margin-top:14px;width:100%;padding:14px;
border-radius:14px;border:none;
background:linear-gradient(180deg,#4e6cff,#2f46ff);
color:#fff;font-size:16px
}
.warning{color:#ff5a5a;font-size:13px;margin-top:8px}

/* SOUND */
#soundToggle{
position:absolute;bottom:12px;right:12px;
z-index:30;font-size:22px;
background:rgba(0,0,0,.6);
padding:10px;border-radius:50%
}
</style>
</head>

<body>
<div class="app">

<audio id="clickSound" src="click.mp3" preload="auto"></audio>
<audio id="bgMusic" src="bg.mp3" preload="auto" loop></audio>
<div id="soundToggle" onclick="toggleSound()">ğŸ”Š</div>

<!-- COINS -->
<img src="coin1.png" class="coin">
<img src="coin13.png" class="coin">
<img src="coin94.png" class="coin">
<img src="coin108.png" class="coin">
<img src="coin216.png" class="coin">

<!-- BUTTONS -->
<div class="buttons">
<div class="btn-img left" onpointerdown="press(this)" onclick="invite()"><img src="inv.png"></div>
<div class="btn-img right" onpointerdown="press(this)" onclick="getBalance()"><img src="bal.png"></div>
<div class="btn-img left" onpointerdown="press(this)" onclick="openWithdraw()"><img src="wit.png"></div>
<div class="btn-img right" onpointerdown="press(this)" onclick="getStats()"><img src="sta.png"></div>
<div class="btn-img left" onpointerdown="press(this)" onclick="openHow()"><img src="how.png"></div>
<div class="btn-img right" onpointerdown="press(this)" onclick="payActivate()"><img src="act.png"></div>
<div class="btn-img left" onpointerdown="press(this)" onclick="openAds()"><img src="for.png"></div>
</div>

<!-- HOW -->
<div class="modal" id="howModal">
<div class="modal-content">
<h2>ğŸš€ FriendPortal Ecosystem</h2>
<p><b>FriendPortal</b> â€” TON-based referral ecosystem combining growth, traffic and advertising.</p>

<ul>
<li>ğŸ‘¥ Invite users â†’ they activate access</li>
<li>ğŸ’ Earn TON from 2 levels</li>
<li>ğŸ“ˆ Advertisers gain targeted audience</li>
</ul>

<p><b>Rewards</b></p>
<ul>
<li>Level 1 â€” <b>0.5 TON</b></li>
<li>Level 2 â€” <b>0.25 TON</b></li>
</ul>

<p><b>Advertising</b></p>
<ul>
<li>ğŸ¯ 25 TON â€” broadcast</li>
<li>â­ 75 TON â€” top (7 days)</li>
<li>ğŸ‘‘ 250 TON â€” top (30 days)</li>
</ul>

<button onclick="closeHow()">Close</button>
</div>
</div>

<!-- WITHDRAW -->
<div class="modal" id="withdrawModal">
<div class="modal-content">
<h2>ğŸ’¸ Withdraw request</h2>
<input id="wAddress" placeholder="TON wallet address">
<input id="wMemo" placeholder="MEMO (if required)">
<div class="warning">âš ï¸ If your wallet requires MEMO â€” do not forget to include it</div>
<button onclick="sendWithdraw()">Send request</button>
<button onclick="closeWithdraw()">Close</button>
</div>
</div>

<!-- ADS -->
<div class="modal" id="adsModal">
<div class="modal-content">
<h2>ğŸ“£ Advertising</h2>
<input id="adLink" placeholder="Your link">
<button onclick="buyAd(25)">ğŸ¯ 25 TON â€” broadcast</button>
<button onclick="buyAd(75)">â­ 75 TON â€” 7 days</button>
<button onclick="buyAd(250)">ğŸ‘‘ 250 TON â€” 30 days</button>
<button onclick="closeAds()">Close</button>
</div>
</div>

<!-- STATS -->
<div class="modal" id="statsModal">
<div class="modal-content" id="statsContent"></div>
</div>

<script>
const API="https://loyce-taxitic-elenora.ngrok-free.dev";
const BOT="FriendPortal_bot";
const tg=Telegram.WebApp; tg.expand();
const user_id=tg.initDataUnsafe?.user?.id;

/* SOUND */
const clickSound=document.getElementById("clickSound");
const bgMusic=document.getElementById("bgMusic");
let sound=true,unlocked=false;

document.addEventListener("pointerdown",()=>{
if(unlocked)return;
clickSound.play().then(()=>{clickSound.pause();clickSound.currentTime=0;unlocked=true});
bgMusic.play().catch(()=>{});
},{once:true});

function toggleSound(){
sound=!sound;
document.getElementById("soundToggle").textContent=sound?"ğŸ”Š":"ğŸ”‡";
sound?bgMusic.play():bgMusic.pause()
}
function press(el){
if(sound&&unlocked){clickSound.currentTime=0;clickSound.play()}
el.classList.add("pressed");
setTimeout(()=>el.classList.remove("pressed"),120);
}

/* COINS */
const coins=document.querySelectorAll(".coin");
const W=innerWidth,H=innerHeight;
const d=[...coins].map(()=>({x:Math.random()*(W-70),y:Math.random()*(H-70),vx:1+Math.random(),vy:1+Math.random()}));
(function anim(){
coins.forEach((c,i)=>{
let o=d[i];o.x+=o.vx;o.y+=o.vy;
if(o.x<0||o.x>W-70)o.vx*=-1;
if(o.y<0||o.y>H-70)o.vy*=-1;
c.style.transform=`translate(${o.x}px,${o.y}px)`;
});
requestAnimationFrame(anim);
})();

/* ACTIONS */
function invite(){
const link=`https://t.me/${BOT}?startapp=${user_id}`;
tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}`);
}

async function getBalance(){
const r=await fetch(API+"/balance",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id})});
const d=await r.json();
alert(`ğŸ’° Balance: ${d.balance} TON\nğŸ”“ Activated: ${d.activated}`);
}

async function getStats(){
statsModal.style.display="flex";
const r=await fetch(API+"/stats",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id})});
const d=await r.json();
statsContent.innerHTML=`<h2>ğŸ“Š Statistics</h2>
<p>ğŸ‘¥ Level 1: ${d.level1}</p>
<p>ğŸ‘¥ Level 2: ${d.level2}</p>
<p>ğŸ’ Earned: ${d.earned} TON</p>
<button onclick="statsModal.style.display='none'">Close</button>`;
}

function payActivate() {
  fetch(API + "/pay", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      user_id: user_id,
      amount: 1
    })
  })
  .then(r => r.json())
  .then(d => {
    if (!d.pay_url) {
      alert("Pay URL not received");
      return;
    }

    // âœ… Telegram Mini App
    if (window.Telegram && Telegram.WebApp) {
      Telegram.WebApp.openLink(d.pay_url);
    } 
    // âœ… Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€
    else {
      window.location.href = d.pay_url;
    }
  })
  .catch(err => {
    console.error(err);
    alert("Payment error");
  });
}


function openHow(){howModal.style.display="flex"}
function closeHow(){howModal.style.display="none"}
function openWithdraw(){withdrawModal.style.display="flex"}
function closeWithdraw(){withdrawModal.style.display="none"}
function openAds(){adsModal.style.display="flex"}
function closeAds(){adsModal.style.display="none"}

function sendWithdraw(){
fetch(API+"/withdraw",{method:"POST",headers:{'Content-Type':'application/json'},
body:JSON.stringify({user_id,address:wAddress.value,memo:wMemo.value})});
alert("âœ… Request sent");
closeWithdraw();
}

function buyAd(amount){
fetch(API+"/ad",{method:"POST",headers:{'Content-Type':'application/json'},
body:JSON.stringify({user_id,amount,link:adLink.value})})
.then(()=>alert("âœ… Request sent"));
}
</script>
</div>
</body>
</html>
