<script>
const API = "https://loyce-taxitic-elenora.ngrok-free.dev";
const tg = Telegram.WebApp;
tg.expand();
const user_id = tg.initDataUnsafe?.user?.id;

/* BALANCE */
async function getBalance(){
  const r = await fetch(API+"/balance",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id})});
  const d = await r.json();
  tg.showPopup({
    title:"ðŸ’° Balance",
    message:`ðŸ’Ž ${d.balance} TON\nðŸ”“ Activated: ${d.activated?"Yes":"No"}`,
    buttons:[{type:"ok"}]
  });
}

/* ACTIVATE */
async function payActivate(){
  const r = await fetch(API+"/activate",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id})});
  const d = await r.json();
  tg.openLink(`ton://transfer/${d.address}?amount=${d.amount*1e9}&text=${encodeURIComponent(d.comment)}`);
}

/* ADS */
async function ads(){
  const link = prompt("ðŸ”— Enter your link");
  const amount = prompt("Choose package: 25 / 75 / 250");
  if(!link||!amount) return;
  const r = await fetch(API+"/ads",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id,amount:Number(amount),link})});
  const d = await r.json();
  tg.openLink(`ton://transfer/${d.address}?amount=${d.amount*1e9}&text=${encodeURIComponent(d.comment)}`);
}

/* WITHDRAW */
async function withdraw(){
  const address = prompt("Your TON address");
  const memo = prompt("MEMO (if required)");
  const amount = prompt("Amount");
  if(!address||!amount) return;
  await fetch(API+"/withdraw",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id,address,memo,amount:Number(amount)})});
  alert("âœ… Request sent");
}
</script>
