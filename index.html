<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FriendPortal</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
* { box-sizing: border-box; }

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background:#000;
  overflow:hidden;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
}

.app {
  position:relative;
  max-width:480px;
  height:100vh;
  margin:0 auto;
  background:url("bg.png") center top / cover no-repeat;
}

.coin {
  position:absolute;
  width:70px;
  height:70px;
  pointer-events:none;
  z-index:1;
}

.buttons {
  position:absolute;
  bottom:20px;
  width:100%;
  padding:0 16px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:5;
}

.btn-img {
  display:flex;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}

.btn-img.left { justify-content:flex-start }
.btn-img.right { justify-content:flex-end }

.btn-img img {
  max-width:250px;
  border-radius:18px;
  transition:transform .12s ease, filter .12s ease;
}

.btn-img.pressed img {
  transform:translateY(6px) scale(.94);
  filter:brightness(.85);
}

.modal {
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(6px);
  z-index:20;
}

.modal-content {
  width:90%;
  max-height:85%;
  background:linear-gradient(180deg,#111,#1b1b1b);
  border-radius:22px;
  padding:22px;
  color:#fff;
  overflow-y:auto;
}

.modal-content h2 { color:#ffd87a; margin-top:0 }
.modal-content p, li { color:#ddd; line-height:1.5 }

.modal-content button {
  margin-top:20px;
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  background:linear-gradient(180deg,#4e6cff,#2f46ff);
  color:#fff;
  font-size:16px;
}

input {
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  margin-top:10px;
}

.warn {
  color:#ff5c5c;
  font-size:14px;
  margin-top:10px;
}

#soundToggle {
  position:absolute;
  bottom:12px;
  right:12px;
  z-index:30;
  font-size:22px;
}
</style>
</head>

<body>
<div class="app">

<audio id="clickSound" src="click.mp3" preload="auto"></audio>
<audio id="bgMusic" src="bg.mp3" preload="auto" loop></audio>

<div id="soundToggle" onclick="toggleSound()">ğŸ”Š</div>

<img src="coin1.png" class="coin">
<img src="coin13.png" class="coin">
<img src="coin94.png" class="coin">
<img src="coin108.png" class="coin">

<div class="buttons">
  <div class="btn-img left" onclick="invite()"><img src="inv.png"></div>
  <div class="btn-img right" onclick="getBalance()"><img src="bal.png"></div>
  <div class="btn-img left" onclick="openWithdraw()"><img src="wit.png"></div>
  <div class="btn-img right" onclick="getStats()"><img src="sta.png"></div>
  <div class="btn-img left" onclick="openHow()"><img src="how.png"></div>
  <div class="btn-img right" onclick="activate()"><img src="act.png"></div>
  <div class="btn-img left" onclick="openAds()"><img src="for.png"></div>
</div>

<!-- HOW -->
<div class="modal" id="howModal">
<div class="modal-content">
<h2>ğŸš€ How FriendPortal works â€” step by step</h2>

<p><b>FriendPortal</b> â€” referral earning platform on the TON blockchain.</p>

<p>ğŸ”¹ <b>Step 1 â€” Invite users</b><br>
Invite friends using your referral link</p>

<p>ğŸ”¹ <b>Step 2 â€” Activation</b><br>
User activates access for <b>1 TON</b></p>

<p>ğŸ”¹ <b>Step 3 â€” Earn</b><br>
Level 1 â€” <b>0.5 TON</b><br>
Level 2 â€” <b>0.25 TON</b></p>

<hr>

<p>ğŸ“£ <b>Advertising packages</b></p>
<ul>
<li>ğŸ¯ 25 TON â€” one-time broadcast</li>
<li>â­ 75 TON â€” top button (7 days)</li>
<li>ğŸ‘‘ 250 TON â€” top placement (30 days)</li>
</ul>

<button onclick="closeHow()">Close</button>
</div>
</div>

<!-- ADS -->
<div class="modal" id="adsModal">
<div class="modal-content">
<h2>ğŸ“£ Advertising</h2>

<input id="adLink" placeholder="Your link">

<button onclick="buyAd(25)">ğŸ¯ 25 TON â€” broadcast</button>
<button onclick="buyAd(75)">â­ 75 TON â€” 7 days</button>
<button onclick="buyAd(250)">ğŸ‘‘ 250 TON â€” 30 days</button>

<button onclick="closeAds()">Close</button>
</div>
</div>

<!-- WITHDRAW -->
<div class="modal" id="withdrawModal">
<div class="modal-content">
<h2>ğŸ’¸ Withdraw</h2>

<input id="wallet" placeholder="Your TON wallet">
<input id="memo" placeholder="MEMO (if required)">

<div class="warn">
âš ï¸ If your wallet requires MEMO â€” do not forget to include it!
</div>

<button onclick="sendWithdraw()">Send request</button>
<button onclick="closeWithdraw()">Close</button>
</div>
</div>

<script>
const API = "https://Ğ¢Ğ’ĞĞ™_NGROK_URL";
const tg = Telegram.WebApp;
tg.expand();

const user_id = tg.initDataUnsafe?.user?.id;

const click = document.getElementById("clickSound");
const music = document.getElementById("bgMusic");
let sound = true;

document.addEventListener("pointerdown", ()=>{ music.play().catch(()=>{}) }, { once:true });

function toggleSound(){
  sound=!sound;
  document.getElementById("soundToggle").textContent=sound?"ğŸ”Š":"ğŸ”‡";
  sound?music.play():music.pause();
}

document.querySelectorAll(".btn-img").forEach(b=>{
  b.addEventListener("mousedown",()=>b.classList.add("pressed"));
  b.addEventListener("mouseup",()=>b.classList.remove("pressed"));
  b.addEventListener("mouseleave",()=>b.classList.remove("pressed"));
});

function invite(){
  tg.openTelegramLink(`https://t.me/FriendPortal_bot?startapp=${user_id}`);
}

async function activate(){
  const r = await fetch(API+"/crypto/activate",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({user_id})
  });
  const d = await r.json();
  tg.openLink(d.pay_url);
}

async function buyAd(amount){
  const link=document.getElementById("adLink").value;
  const r = await fetch(API+"/crypto/ad",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({user_id,amount,link})
  });
  const d = await r.json();
  tg.openLink(d.pay_url);
}

async function getBalance(){
  const r=await fetch(API+"/balance",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id})});
  const d=await r.json();
  alert(`ğŸ’° Balance: ${d.balance} TON\nActivated: ${d.activated?"Yes":"No"}`);
}

async function getStats(){
  const r=await fetch(API+"/stats",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id})});
  const d=await r.json();
  alert(`ğŸ‘¥ Level 1: ${d.level1}\nğŸ‘¥ Level 2: ${d.level2}\nğŸ’ Earned: ${d.earned} TON`);
}

function openHow(){howModal.style.display="flex"}
function closeHow(){howModal.style.display="none"}
function openAds(){adsModal.style.display="flex"}
function closeAds(){adsModal.style.display="none"}
function openWithdraw(){withdrawModal.style.display="flex"}
function closeWithdraw(){withdrawModal.style.display="none"}

async function sendWithdraw(){
  const wallet=document.getElementById("wallet").value;
  const memo=document.getElementById("memo").value;
  await fetch(API+"/withdraw",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id,wallet,memo})});
  alert("âœ… Withdraw request sent");
}
</script>

</div>
</body>
</html>
