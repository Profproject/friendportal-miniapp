<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FriendPortal</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
* { box-sizing: border-box; }

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #000;
  overflow: hidden;
}

.app {
  position: relative;
  width: 100%;
  max-width: 480px;
  height: 100vh;
  margin: 0 auto;
  background: url("bg.png") center top / cover no-repeat;
  overflow: hidden;
}

/* COINS */
.coin {
  position: absolute;
  width: 70px;
  height: 70px;
  pointer-events: none;
  z-index: 1;
}

/* BUTTONS */
.buttons {
  position: absolute;
  bottom: 20px;
  left: 0;
  width: 100%;
  padding: 0 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 5;
}

.btn-img {
  display: flex;
  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}
.btn-img.left { justify-content: flex-start; }
.btn-img.right { justify-content: flex-end; }

.btn-img img {
  width: 100%;
  max-width: 250px;
  border-radius: 18px;
  transition: transform .12s ease, filter .12s ease;
}

.btn-img.pressed img {
  transform: translateY(6px) scale(.94);
  filter: brightness(.85);
}

/* MODAL */
.modal {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.65);
  backdrop-filter: blur(6px);
  z-index: 20;
}

.modal-content {
  width: 90%;
  max-height: 85%;
  background: linear-gradient(180deg,#111,#1b1b1b);
  color: #fff;
  border-radius: 22px;
  padding: 22px;
  overflow-y: auto;
}

.modal-content h2 { color:#ffd87a; margin-top:0; }
.modal-content p, li { color:#ddd; line-height:1.5; }

.modal-content input {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:12px;
  border:none;
  font-size:16px;
}

.warn {
  margin-top:10px;
  color:#ff5c5c;
  font-size:14px;
}

.modal-content button {
  margin-top:14px;
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  background: linear-gradient(180deg,#4e6cff,#2f46ff);
  color:#fff;
  font-size:16px;
}

#soundToggle {
  position:absolute;
  bottom:12px;
  right:12px;
  z-index:30;
  font-size:22px;
  background:rgba(0,0,0,.6);
  padding:10px;
  border-radius:50%;
}
</style>
</head>

<body>
<div class="app">

<audio id="clickSound" src="click.mp3" preload="auto"></audio>
<audio id="bgMusic" src="bg.mp3" preload="auto" loop></audio>
<div id="soundToggle" onclick="toggleSound()">ğŸ”Š</div>

<!-- COINS -->
<img src="coin1.png" class="coin">
<img src="coin13.png" class="coin">
<img src="coin94.png" class="coin">
<img src="coin108.png" class="coin">
<img src="coin216.png" class="coin">

<div class="buttons">
  <div class="btn-img left" onclick="invite()"><img src="inv.png"></div>
  <div class="btn-img right" onclick="showBalance()"><img src="bal.png"></div>
  <div class="btn-img left" onclick="openWithdraw()"><img src="wit.png"></div>
  <div class="btn-img right" onclick="openStats()"><img src="sta.png"></div>
  <div class="btn-img left" onclick="openHow()"><img src="how.png"></div>
  <div class="btn-img right" onclick="activate()"><img src="act.png"></div>
  <div class="btn-img left" onclick="openAds()"><img src="for.png"></div>
</div>

<!-- HOW -->
<div class="modal" id="howModal">
<div class="modal-content">
<h2>ğŸš€ How FriendPortal works</h2>
<p>ğŸ’ <b>FriendPortal</b> â€” referral earning platform on TON blockchain.</p>

<p>ğŸ‘¥ <b>Invite users</b><br>
Share your referral link and grow your network.</p>

<p>ğŸ”“ <b>Activation</b><br>
User activates access with <b>1 TON</b>.</p>

<p>ğŸ’° <b>Earn rewards</b></p>
<ul>
<li>ğŸ¥‡ Level 1 â€” <b>0.5 TON</b></li>
<li>ğŸ¥ˆ Level 2 â€” <b>0.25 TON</b></li>
</ul>

<p>ğŸ“£ <b>Advertising packages</b></p>
<ul>
<li>ğŸ¯ 25 TON â€” one-time broadcast</li>
<li>â­ 75 TON â€” top button (7 days)</li>
<li>ğŸ‘‘ 250 TON â€” top placement (30 days)</li>
</ul>

<button onclick="closeModal('howModal')">Close</button>
</div>
</div>

<!-- STATS -->
<div class="modal" id="statsModal">
<div class="modal-content" id="statsContent"></div>
</div>

<!-- WITHDRAW -->
<div class="modal" id="withdrawModal">
<div class="modal-content">
<h2>ğŸ’¸ Withdraw TON</h2>

<input id="wallet" placeholder="Your TON wallet address">
<input id="memo" placeholder="MEMO (if required)">

<div class="warn">âš ï¸ If your wallet requires MEMO â€” include it, otherwise funds may be lost.</div>

<button onclick="sendWithdraw()">Send request</button>
<button onclick="closeModal('withdrawModal')">Close</button>
</div>
</div>

<!-- ADS -->
<div class="modal" id="adsModal">
<div class="modal-content">
<h2>ğŸ“£ Advertising</h2>

<button onclick="buyAd(25,'ğŸ¯ Broadcast')">ğŸ¯ 25 TON â€” Broadcast</button>
<button onclick="buyAd(75,'â­ Top 7 days')">â­ 75 TON â€” Top 7 days</button>
<button onclick="buyAd(250,'ğŸ‘‘ Top 30 days')">ğŸ‘‘ 250 TON â€” Top 30 days</button>

<button onclick="closeModal('adsModal')">Close</button>
</div>
</div>

<script>
const API = "https://loyce-taxitic-elenora.ngrok-free.dev";
const BOT = "FriendPortal_bot";
const TON_ADDRESS = "UQBGmVGYvN103KOMBvHyZ08k3v_vjr3UA1BWSSudnyeIfTmH";

const tg = Telegram.WebApp;
tg.expand();
const user_id = tg.initDataUnsafe?.user?.id;

/* SOUND */
const click = document.getElementById("clickSound");
const music = document.getElementById("bgMusic");
let sound = true, unlocked=false;

document.addEventListener("pointerdown",()=>{
 if(unlocked) return;
 click.play().then(()=>{click.pause();click.currentTime=0;unlocked=true;music.play();});
},{once:true});

function toggleSound(){
 sound=!sound;
 document.getElementById("soundToggle").textContent=sound?"ğŸ”Š":"ğŸ”‡";
 sound?music.play():music.pause();
}

function playClick(){ if(sound && unlocked){click.currentTime=0;click.play();} }

/* BUTTON PRESS */
document.querySelectorAll(".btn-img").forEach(b=>{
 ["mousedown","touchstart"].forEach(e=>b.addEventListener(e,()=>b.classList.add("pressed")));
 ["mouseup","mouseleave","touchend"].forEach(e=>b.addEventListener(e,()=>b.classList.remove("pressed")));
});

/* COINS */
const coins=document.querySelectorAll(".coin");
const W=window.innerWidth,H=window.innerHeight;
const data=[...coins].map(()=>({x:Math.random()*(W-70),y:Math.random()*(H-70),vx:1+Math.random(),vy:1+Math.random()}));
function animate(){
 coins.forEach((c,i)=>{
  const d=data[i];
  d.x+=d.vx; d.y+=d.vy;
  if(d.x<0||d.x>W-70) d.vx*=-1;
  if(d.y<0||d.y>H-70) d.vy*=-1;
  c.style.transform=`translate(${d.x}px,${d.y}px)`;
 });
 requestAnimationFrame(animate);
}
animate();

/* ACTIONS */
function invite(){
 const link=`https://t.me/${BOT}?startapp=${user_id}`;
 tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}`);
}

async function showBalance(){
 const r=await fetch(API+"/balance",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id})});
 const d=await r.json();
 alert(`ğŸ’° Balance: ${d.balance} TON\nğŸ”“ Activated: ${d.activated}`);
}

function openWithdraw(){openModal('withdrawModal');}

async function openStats(){
 openModal('statsModal');
 const r=await fetch(API+"/stats",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id})});
 const d=await r.json();
 document.getElementById("statsContent").innerHTML=`
 <h2>ğŸ“Š Statistics</h2>
 <p>ğŸ‘¥ Level 1: <b>${d.level1}</b></p>
 <p>ğŸ‘¥ Level 2: <b>${d.level2}</b></p>
 <hr>
 <p>ğŸ’ Earned: <b>${d.earned} TON</b></p>
 <button onclick="closeModal('statsModal')">Close</button>`;
}

function activate(){
 const url=`ton://transfer/${TON_ADDRESS}?amount=${1e9}&text=${encodeURIComponent("FriendPortal activation "+user_id)}`;
 tg.openLink(url);
}

function sendWithdraw(){
 alert("ğŸ“¨ Withdraw request sent. Admin will process it manually.");
 closeModal('withdrawModal');
}

function buyAd(amount,title){
 const url=`ton://transfer/${TON_ADDRESS}?amount=${amount*1e9}&text=${encodeURIComponent(title+" | user "+user_id)}`;
 tg.openLink(url);
}

function openHow(){openModal('howModal');}
function openAds(){openModal('adsModal');}
function openModal(id){document.getElementById(id).style.display="flex";}
function closeModal(id){document.getElementById(id).style.display="none";}
</script>

</div>
</body>
</html>
