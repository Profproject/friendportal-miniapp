<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FriendPortal</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{box-sizing:border-box}
html,body{
margin:0;padding:0;width:100%;height:100%;
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:#000;overflow:hidden
}
.app{
position:relative;width:100%;max-width:480px;
height:100vh;margin:0 auto;
background:url("bg.png") center top/cover no-repeat;
overflow:hidden
}

/* COINS */
.coin{
position:absolute;
width:70px;height:70px;
object-fit:contain;
pointer-events:none;
z-index:1
}

/* BUTTONS */
.buttons{
position:absolute;bottom:20px;left:0;width:100%;
padding:0 16px;display:flex;flex-direction:column;
gap:10px;z-index:5
}
.btn-img{display:flex;cursor:pointer;-webkit-tap-highlight-color:transparent}
.btn-img.left{justify-content:flex-start}
.btn-img.right{justify-content:flex-end}
.btn-img img{
max-width:250px;width:100%;
border-radius:18px;
transition:transform .12s,filter .12s
}
.btn-img.pressed img{
transform:translateY(6px) scale(.94);
filter:brightness(.85)
}

/* MODALS */
.modal{
position:fixed;inset:0;display:none;
align-items:center;justify-content:center;
background:rgba(0,0,0,.65);
backdrop-filter:blur(6px);z-index:20
}
.modal-content{
width:90%;max-height:85%;overflow:auto;
background:linear-gradient(180deg,#111,#1b1b1b);
border-radius:22px;padding:22px;color:#fff
}
.modal-content h2{color:#ffd87a}
.modal-content h3{margin-top:18px;font-size:20px}
.modal-content p{font-size:16px;opacity:.9;line-height:1.6}
.modal-content input{
width:100%;padding:12px;border-radius:12px;border:none;margin-top:10px
}
.modal-content button{
margin-top:14px;width:100%;padding:14px;
border-radius:14px;border:none;
background:linear-gradient(180deg,#4e6cff,#2f46ff);
color:#fff;font-size:16px
}

/* CLOSE BUTTON */
.btn-close{
background:linear-gradient(180deg,#ff5a5a,#d93434)!important;
box-shadow:0 6px 14px rgba(255,90,90,.35);
}
.btn-close:active{
transform:translateY(4px) scale(.96);
filter:brightness(.9);
}

/* WARNING */
.warning{
color:#ff5a5a;
font-weight:700;
font-size:16px;
margin-top:10px
}

/* SOUND */
#soundToggle{
position:absolute;
bottom:14px;
right:14px;
z-index:30;
font-size:28px;
background:rgba(0,0,0,.65);
padding:14px;
border-radius:50%;
}
#soundToggle.muted::after{
content:"";
position:absolute;
top:10px;
left:10px;
width:36px;
height:3px;
background:red;
transform:rotate(-45deg);
border-radius:2px;
}
</style>
</head>

<body>
<div class="app">

<audio id="clickSound" src="click.mp3" preload="auto"></audio>
<audio id="bgMusic" src="bg.mp3" preload="auto" loop></audio>
<div id="soundToggle" onclick="toggleSound()">üîä</div>

<!-- COINS -->
<img src="coin1.png" class="coin">
<img src="coin13.png" class="coin">
<img src="coin94.png" class="coin">
<img src="coin108.png" class="coin">
<img src="coin216.png" class="coin">

<!-- BUTTONS -->
<div class="buttons">
<div class="btn-img left" onclick="press(this);invite()"><img src="inv.png"></div>
<div class="btn-img right" onclick="press(this);openBalance()"><img src="bal.png"></div>
<div class="btn-img left" onclick="press(this);openWithdraw()"><img src="wit.png"></div>
<div class="btn-img right" onclick="press(this);getStats()"><img src="sta.png"></div>
<div class="btn-img left" onclick="press(this);openHow()"><img src="how.png"></div>
<div class="btn-img right" onclick="press(this);payActivate()"><img src="act.png"></div>
<div class="btn-img left" onclick="press(this);openAds()"><img src="for.png"></div>
</div>

<!-- WITHDRAW -->
<div class="modal" id="withdrawModal">
<div class="modal-content">
<h2>üí∏ Withdraw Request</h2>
<input id="wAddress" placeholder="TON wallet address">
<input id="wMemo" placeholder="MEMO (if required)">
<div class="warning">
‚ö†Ô∏è IMPORTANT: If your wallet requires MEMO and you do not include it,
your funds may be permanently lost.
</div>
<button onclick="sendWithdraw()">Send request</button>
<button class="btn-close" onclick="closeWithdraw()">Close</button>
</div>
</div>

<script>
const API="https://loyce-taxitic-elenora.ngrok-free.dev";
const BOT="FriendPortal_bot";
const tg=Telegram.WebApp;tg.expand();
const user_id=tg.initDataUnsafe?.user?.id;

let userActivated = false;

/* SOUND */
const clickSound=document.getElementById("clickSound");
const bgMusic=document.getElementById("bgMusic");
const soundBtn=document.getElementById("soundToggle");
clickSound.volume=0.9;bgMusic.volume=0.25;
let sound=true,unlocked=false;

document.addEventListener("pointerdown",()=>{
if(!unlocked){
unlocked=true;
bgMusic.play().catch(()=>{});
}
});

function playClick(){
if(!sound)return;
clickSound.currentTime=0;
clickSound.play().catch(()=>{});
}

function toggleSound(){
sound=!sound;
if(sound){
bgMusic.play();
soundBtn.classList.remove("muted");
}else{
bgMusic.pause();
soundBtn.classList.add("muted");
}
}

/* ACTIONS */
function press(el){
playClick();
el.classList.add("pressed");
setTimeout(()=>el.classList.remove("pressed"),120);
}

async function openBalance(){
const r=await fetch(API+"/balance",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({user_id})
});
const d=await r.json();
userActivated = d.activated;
balAmount.textContent=d.balance+" TON";
balActive.textContent=d.activated ? "Activated" : "Not activated";
balanceModal.style.display="flex";
}

async function sendWithdraw(){
if(!userActivated){
alert("‚ùå Activate access first (1 TON)");
return;
}

const address=document.getElementById("wAddress").value;
const memo=document.getElementById("wMemo").value;

const r = await fetch(API+"/withdraw",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({user_id,address,memo})
});

const d = await r.json();
if(d.error){
alert("‚ùå Withdraw denied");
return;
}

alert("Withdraw request sent");
closeWithdraw();
}
</script>
</div>
</body>
</html>
