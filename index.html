<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FriendPortal</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
* { box-sizing: border-box; }

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #000;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  overflow: hidden;
}

.app {
  position: relative;
  width: 100%;
  max-width: 480px;
  height: 100vh;
  margin: 0 auto;
  background: url("bg.png") center / cover no-repeat;
  overflow: hidden;
}

/* COINS */
.coin {
  position: absolute;
  width: 70px;
  height: 70px;
  pointer-events: none;
}
.coin img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  aspect-ratio: 1/1;
}

/* BUTTONS */
.buttons {
  position: absolute;
  bottom: 20px;
  width: 100%;
  padding: 0 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 5;
}

.btn-img {
  display: flex;
  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}
.btn-img.left { justify-content: flex-start; }
.btn-img.right { justify-content: flex-end; }

.btn-img img {
  max-width: 250px;
  width: 100%;
  border-radius: 18px;
  transition: transform .12s ease, filter .12s ease;
}

.btn-img.pressed img {
  transform: translateY(6px) scale(.94);
  filter: brightness(.85);
}

/* MODAL */
.modal {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.65);
  backdrop-filter: blur(6px);
  z-index: 20;
}

.modal-content {
  width: 90%;
  max-height: 85%;
  background: linear-gradient(180deg,#111,#1b1b1b);
  color: #fff;
  border-radius: 22px;
  padding: 22px;
  overflow-y: auto;
}

.modal-content h2 {
  margin-top: 0;
  color: #ffd87a;
}

.modal-content p {
  line-height: 1.6;
  font-size: 16px;
}

.modal-content button {
  margin-top: 20px;
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: none;
  background: linear-gradient(180deg,#4e6cff,#2f46ff);
  color: #fff;
  font-size: 16px;
}
</style>
</head>

<body>
<div class="app">

<audio id="clickSound" src="click.mp3" preload="auto"></audio>
<audio id="bgMusic" src="bg.mp3" preload="auto" loop></audio>

<!-- COINS -->
<div class="coin"><img src="coin1.png"></div>
<div class="coin"><img src="coin13.png"></div>
<div class="coin"><img src="coin94.png"></div>
<div class="coin"><img src="coin108.png"></div>
<div class="coin"><img src="coin216.png"></div>

<div class="buttons">

<div class="btn-img left" onclick="invite()"><img src="inv.png"></div>
<div class="btn-img right" onclick="getBalance()"><img src="bal.png"></div>
<div class="btn-img left" onclick="withdraw()"><img src="wit.png"></div>
<div class="btn-img right" onclick="getStats()"><img src="sta.png"></div>
<div class="btn-img left" onclick="openHow()"><img src="how.png"></div>
<div class="btn-img right" onclick="activate()"><img src="act.png"></div>
<div class="btn-img left" onclick="ads()"><img src="for.png"></div>

</div>

<!-- HOW -->
<div class="modal" id="howModal">
  <div class="modal-content">
    <h2>ğŸš€ FriendPortal Ecosystem</h2>
    <p>FriendPortal is a growing referral ecosystem on TON.</p>
    <p>ğŸ‘¥ Invite users â†’ ğŸ” they activate â†’ ğŸ’ you earn TON daily.</p>
    <p><b>ğŸ“ˆ Growth potential:</b> advertisers gain exposure as the community expands.</p>

    <p><b>ğŸ’ Referral rewards</b></p>
    <p>ğŸ¥‡ Level 1 â€” 0.5 TON</p>
    <p>ğŸ¥ˆ Level 2 â€” 0.25 TON</p>

    <p><b>ğŸ“£ Advertising packages</b></p>
    <p>ğŸ”¥ 25 TON â€” Broadcast</p>
    <p>â­ 75 TON â€” Top placement (7 days)</p>
    <p>ğŸ‘‘ 250 TON â€” Premium top (30 days)</p>

    <button onclick="closeHow()">Close</button>
  </div>
</div>

<!-- STATS -->
<div class="modal" id="statsModal">
  <div class="modal-content" id="statsContent"></div>
</div>

<script>
const API = "https://loyce-taxitic-elenora.ngrok-free.dev";
const tg = Telegram.WebApp;
tg.expand();

const user_id = tg.initDataUnsafe?.user?.id;

/* BUTTON EFFECT */
document.querySelectorAll(".btn-img").forEach(btn=>{
  btn.addEventListener("pointerdown",()=>btn.classList.add("pressed"));
  btn.addEventListener("pointerup",()=>btn.classList.remove("pressed"));
  btn.addEventListener("pointerleave",()=>btn.classList.remove("pressed"));
});

/* COINS */
const coins=document.querySelectorAll(".coin");
const W=window.innerWidth,H=window.innerHeight;
const data=[...coins].map(()=>({x:Math.random()*(W-70),y:Math.random()*(H-70),vx:Math.random()*1.5+.5,vy:Math.random()*1.5+.5}));
function animate(){
  coins.forEach((c,i)=>{
    const d=data[i];
    d.x+=d.vx; d.y+=d.vy;
    if(d.x<=0||d.x>=W-70)d.vx*=-1;
    if(d.y<=0||d.y>=H-70)d.vy*=-1;
    c.style.transform=`translate3d(${d.x}px,${d.y}px,0)`;
  });
  requestAnimationFrame(animate);
}
animate();

/* ACTIONS */
function invite(){
  tg.openTelegramLink(`https://t.me/FriendPortal_bot?startapp=${user_id}`);
}

async function getBalance(){
  const r=await fetch(API+"/balance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id})});
  const d=await r.json();
  alert(`ğŸ’° Balance: ${d.balance} TON\nğŸ”“ Activated: ${d.activated?"Yes":"No"}`);
}

async function getStats(){
  document.getElementById("statsModal").style.display="flex";
  const r=await fetch(API+"/stats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id})});
  const d=await r.json();
  document.getElementById("statsContent").innerHTML=`
  <h2>ğŸ“Š Statistics</h2>
  <p>ğŸ‘¥ Level 1: <b>${d.level1}</b></p>
  <p>ğŸ‘¥ Level 2: <b>${d.level2}</b></p>
  <p>ğŸ’ Earned: <b>${d.earned} TON</b></p>
  <button onclick="closeStats()">Close</button>`;
}

function closeStats(){document.getElementById("statsModal").style.display="none";}
function openHow(){document.getElementById("howModal").style.display="flex";}
function closeHow(){document.getElementById("howModal").style.display="none";}
function ads(){alert("ğŸ“£ Advertising packages available");}

async function activate(){
  const r=await fetch(API+"/activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id})});
  const d=await r.json();
  tg.openLink(`ton://transfer/${d.address}?amount=${d.amount*1e9}&text=${encodeURIComponent(d.comment)}`);
}

function withdraw(){
  alert("ğŸ’¸ Withdrawal available after activation");
}
</script>

</body>
</html>
