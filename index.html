<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FriendPortal</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;padding:0;width:100%;height:100%;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#000;overflow:hidden
}
.app{
  position:relative;
  max-width:480px;
  height:100vh;
  margin:0 auto;
  background:url("bg.png") center top/cover no-repeat;
}
.coin{
  position:absolute;width:70px;height:70px;
  pointer-events:none;z-index:1
}
.buttons{
  position:absolute;bottom:20px;left:0;width:100%;
  padding:0 16px;display:flex;flex-direction:column;gap:10px;z-index:5
}
.btn-img{display:flex;cursor:pointer;-webkit-tap-highlight-color:transparent}
.btn-img.left{justify-content:flex-start}
.btn-img.right{justify-content:flex-end}
.btn-img img{
  max-width:250px;border-radius:18px;
  transition:.12s
}
.btn-img.pressed img{
  transform:translateY(6px) scale(.94);
  filter:brightness(.85)
}
.modal{
  position:fixed;inset:0;display:none;
  align-items:center;justify-content:center;
  background:rgba(0,0,0,.7);z-index:20
}
.modal-content{
  width:90%;max-height:85%;overflow:auto;
  background:linear-gradient(180deg,#111,#1b1b1b);
  border-radius:22px;padding:22px;color:#fff
}
.modal-content h2{margin-top:0;color:#ffd87a}
.modal-content button{
  margin-top:18px;width:100%;padding:14px;
  border-radius:14px;border:none;
  background:linear-gradient(180deg,#4e6cff,#2f46ff);
  color:#fff;font-size:16px
}
#soundToggle{
  position:absolute;bottom:12px;right:12px;
  background:rgba(0,0,0,.6);
  padding:10px;border-radius:50%;font-size:22px
}
</style>
</head>

<body>
<div class="app">

<audio id="clickSound" src="click.mp3" preload="auto"></audio>
<audio id="bgMusic" src="bg.mp3" preload="auto" loop></audio>

<div id="soundToggle" onclick="toggleSound()">ğŸ”Š</div>

<img src="coin1.png" class="coin">
<img src="coin13.png" class="coin">
<img src="coin94.png" class="coin">
<img src="coin108.png" class="coin">
<img src="coin216.png" class="coin">

<div class="buttons">

<div class="btn-img left" onpointerdown="playClick()" onclick="invite()"><img src="inv.png"></div>
<div class="btn-img right" onpointerdown="playClick()" onclick="getBalance()"><img src="bal.png"></div>
<div class="btn-img left" onpointerdown="playClick()" onclick="withdraw()"><img src="wit.png"></div>
<div class="btn-img right" onpointerdown="playClick()" onclick="getStats()"><img src="sta.png"></div>
<div class="btn-img left" onpointerdown="playClick()" onclick="openHow()"><img src="how.png"></div>
<div class="btn-img right" onpointerdown="playClick()" onclick="payActivate()"><img src="act.png"></div>
<div class="btn-img left" onpointerdown="playClick()" onclick="openAds()"><img src="for.png"></div>

</div>

<div class="modal" id="howModal">
  <div class="modal-content">
    <h2>â„¹ï¸ How FriendPortal Works</h2>
    <p>Invite users, they activate access and you earn TON.</p>
    <p><b>ğŸ’ Rewards</b></p>
    <ul>
      <li>Level 1 â€” 0.5 TON</li>
      <li>Level 2 â€” 0.25 TON</li>
    </ul>
    <button onclick="closeHow()">Close</button>
  </div>
</div>

<div class="modal" id="statsModal">
  <div class="modal-content" id="statsContent"></div>
</div>

<div class="modal" id="adsModal">
  <div class="modal-content">
    <h2>ğŸ“£ Advertising</h2>
    <p>Choose package:</p>
    <button onclick="payAd(25)">ğŸ¯ 25 TON â€” One-time broadcast</button>
    <button onclick="payAd(75)">â­ 75 TON â€” Button 7 days</button>
    <button onclick="payAd(200)">ğŸ‘‘ 200 TON â€” Button 30 days</button>
    <button onclick="closeAds()">Close</button>
  </div>
</div>

<script>
const API="https://loyce-taxitic-elenora.ngrok-free.dev"
const BOT="FriendPortal_bot"
const tg=Telegram.WebApp
tg.expand()

const user=tg.initDataUnsafe?.user
const user_id=user?.id

const clickSound=document.getElementById("clickSound")
const bgMusic=document.getElementById("bgMusic")
let sound=true,unlocked=false

document.addEventListener("pointerdown",()=>{
  if(unlocked)return
  clickSound.play().then(()=>{clickSound.pause();clickSound.currentTime=0;unlocked=true})
},{once:true})

function playClick(){if(sound&&unlocked){clickSound.currentTime=0;clickSound.play()}}
function toggleSound(){
  sound=!sound
  document.getElementById("soundToggle").textContent=sound?"ğŸ”Š":"ğŸ”‡"
  sound?bgMusic.play():bgMusic.pause()
}

function invite(){
  const link=`https://t.me/${BOT}?startapp=ref_${user_id}`
  tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}`)
}

async function getBalance(){
  const r=await fetch(API+"/balance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id})})
  const d=await r.json()
  alert(`ğŸ’° Balance: ${d.balance} TON\nğŸ” Activated: ${d.activated?"Yes":"No"}`)
}

async function withdraw(){
  const r=await fetch(API+"/balance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id})})
  const d=await r.json()
  if(d.balance<5)return alert("âŒ Minimum withdrawal: 5 TON")
  if(!d.activated)return alert("ğŸ” Activate withdrawals first (1 TON)")
  alert("âœ… Withdrawal request accepted (manual for now)")
}

async function payActivate(){
  const r=await fetch(API+"/pay",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id,amount:1})})
  const d=await r.json()
  tg.openLink(`ton://transfer/${d.address}?amount=${d.amount*1e9}&text=${encodeURIComponent(d.comment)}`)
}

async function getStats(){
  document.getElementById("statsModal").style.display="flex"
  const r=await fetch(API+"/stats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id})})
  const d=await r.json()
  document.getElementById("statsContent").innerHTML=`
  <h2>ğŸ“Š Statistics</h2>
  <p>ğŸ‘¥ Level 1: <b>${d.level1}</b></p>
  <p>ğŸ‘¥ Level 2: <b>${d.level2}</b></p>
  <hr>
  <p>ğŸ’ Earned: <b>${d.earned} TON</b></p>
  <button onclick="closeStats()">Close</button>`
}

function closeStats(){document.getElementById("statsModal").style.display="none"}
function openHow(){document.getElementById("howModal").style.display="flex"}
function closeHow(){document.getElementById("howModal").style.display="none"}
function openAds(){document.getElementById("adsModal").style.display="flex"}
function closeAds(){document.getElementById("adsModal").style.display="none"}

async function payAd(amount){
  const r=await fetch(API+"/pay",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id,amount})})
  const d=await r.json()
  tg.openLink(`ton://transfer/${d.address}?amount=${d.amount*1e9}&text=${encodeURIComponent("AD:"+user_id)}`)
}
</script>

</div>
</body>
</html>
